concurrency: 10
base: 'http://localhost:8080'
iterations: 100
rampup: 5

plan:
  # Аутентификация
  - name: Login
    request:
      url: /api/auth/
      method: POST
      headers:
        Content-Type: 'application/json'
      body: '{"email": "admin@example.com", "password": "re0IcASsUTRq"}'
    assign: auth_response

  # Проекты
  - name: Get all projects
    request:
      url: /api/project/
#      headers:
#        Cookie: '{{ auth_response.headers.cookie }}'

  - name: Create new project
    request:
      url: /api/project/
      method: POST
      headers:
    #    Cookie: '{{ auth_response.headers.cookie }}'
        Content-Type: 'application/json'
      body: '{"name": "Test Project", "scope": "test.com"}'
    assign: project_response

  - name: Get project details
    request:
      url: /api/project/{{ project_response.body.id }}
      headers:
        Cookie: '{{ auth_response.headers.cookie }}'

  # Хосты
  - name: Create host
    request:
      url: /api/project/{{ project_response.body.id }}/host
      method: POST
      headers:
     #   Cookie: '{{ auth_response.headers.cookie }}'
        Content-Type: 'application/json'
      body: '{"name": "test.com", "ip": "192.168.1.1"}'
    assign: host_response

  - name: Get project hosts
    request:
      url: /api/project/{{ project_response.body.id }}/hosts
     # headers:
     #   Cookie: '{{ auth_response.headers.cookie }}'

  # Сканирование
  - name: Start scan
    request:
      url: /api/project/{{ project_response.body.id }}/scan
      method: POST
      headers:
     #   Cookie: '{{ auth_response.headers.cookie }}'
        Content-Type: 'application/json'
      body: '{"type": "nmap", "target": "test.com"}'
    assign: scan_response

  - name: Get scan results
    request:
      url: /api/project/{{ project_response.body.id }}/scan/nmap/{{ scan_response.body.scan_id }}
     # headers:
     #   Cookie: '{{ auth_response.headers.cookie }}'

  # Отчеты
  - name: Get report templates
    request:
      url: /api/template/all
      #headers:
      #  Cookie: '{{ auth_response.headers.cookie }}'
    assign: templates_response

  - name: Create report
    request:
      url: /api/project/{{ project_response.body.id }}/report
      method: POST
      headers:
     #   Cookie: '{{ auth_response.headers.cookie }}'
        Content-Type: 'application/json'
      body: '{"template_id": {{ templates_response.body[0].id }}}'

  # Команды
  - name: Get teams
    request:
      url: /api/team/
     # headers:
     #   Cookie: '{{ auth_response.headers.cookie }}'

  - name: Create team
    request:
      url: /api/team/
      method: POST
      headers:
      #  Cookie: '{{ auth_response.headers.cookie }}'
        Content-Type: 'application/json'
      body: '{"name": "Test Team"}'

  # Проверки
  - name: Assert project creation
    assert:
      key: project_response.status
      value: 201

  - name: Assert scan start
    assert:
      key: scan_response.status
      value: 200

  - name: Assert report creation
    assert:
      key: report_response.status
      value: 200
